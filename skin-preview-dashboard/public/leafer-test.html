<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leafer-UI Test</title>
  <script src="https://unpkg.com/leafer-ui@2.0.0/dist/web.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 20px;
      background: #1a1a2e;
      font-family: system-ui, sans-serif;
    }
    h1 {
      color: white;
      margin-bottom: 20px;
    }
    #container {
      border: 2px solid #334155;
      border-radius: 12px;
      overflow: hidden;
    }
  </style>
</head>
<body>
  <h1>Leafer-UI 测试 - 皮肤布局预览</h1>
  <div id="container"></div>

  <script>
    // 模拟皮肤数据
    const skinData = {
      root: {
        bbox: [0, 0, 390, 800],
        children: [
          { name: "顶部渐变", type: "rounded-rectangle", bbox: [0, 50, 390, 200] },
          { name: "下载+头部", type: "frame", bbox: [0, 0, 390, 50] },
          { name: "轮播", type: "frame", bbox: [12, 116, 366, 100] },
          { name: "厂商 tab", type: "frame", bbox: [12, 230, 366, 60] },
          { name: "公告搜索", type: "frame", bbox: [12, 300, 366, 50] },
          { name: "_营销图轮播", type: "instance", bbox: [12, 360, 366, 80] },
          { name: "hot", type: "frame", bbox: [12, 450, 366, 200] },
          { name: "_tab bar", type: "instance", bbox: [0, 740, 390, 60] },
        ]
      }
    };

    // 颜色映射
    const typeColors = {
      'frame': '#3b82f6',
      'instance': '#8b5cf6',
      'rounded-rectangle': '#10b981',
      'rectangle': '#10b981',
      'default': '#6b7280',
    };

    function getColor(type) {
      return typeColors[type] || typeColors['default'];
    }

    // 创建 Leafer 画布
    const { Leafer, Rect, Text, Group } = LeaferUI;
    const scale = 1;
    const padding = 20;
    const frameWidth = skinData.root.bbox[2];
    const frameHeight = skinData.root.bbox[3];

    const leafer = new Leafer({
      view: document.getElementById('container'),
      width: frameWidth * scale + padding * 2,
      height: frameHeight * scale + padding * 2,
      fill: '#1a1a2e',
    });

    // 主容器组
    const mainGroup = new Group({
      x: padding,
      y: padding,
    });

    // 绘制根节点背景
    const rootRect = new Rect({
      x: 0,
      y: 0,
      width: frameWidth * scale,
      height: frameHeight * scale,
      fill: '#0f172a',
      stroke: '#334155',
      strokeWidth: 2,
      cornerRadius: 12,
    });
    mainGroup.add(rootRect);

    // 绘制子节点
    skinData.root.children.forEach((child, index) => {
      const [x, y, width, height] = child.bbox;
      const color = getColor(child.type);

      const rect = new Rect({
        x: x * scale,
        y: y * scale,
        width: Math.max(width * scale, 4),
        height: Math.max(height * scale, 4),
        fill: color + '30',
        stroke: color,
        strokeWidth: 2,
        cornerRadius: 4,
      });

      // 添加交互
      rect.on('pointer.enter', () => {
        rect.fill = color + '60';
        rect.strokeWidth = 3;
      });
      rect.on('pointer.leave', () => {
        rect.fill = color + '30';
        rect.strokeWidth = 2;
      });

      mainGroup.add(rect);

      // 添加标签
      if (width * scale > 50 && height * scale > 25) {
        const label = new Text({
          x: x * scale + 4,
          y: y * scale + 4,
          text: child.name,
          fill: '#ffffff',
          fontSize: 11,
          fontFamily: 'system-ui, sans-serif',
          fontWeight: 500,
        });
        mainGroup.add(label);

        if (height * scale > 40) {
          const sizeLabel = new Text({
            x: x * scale + 4,
            y: y * scale + 18,
            text: `${width}×${height}`,
            fill: '#94a3b8',
            fontSize: 9,
            fontFamily: 'system-ui, sans-serif',
          });
          mainGroup.add(sizeLabel);
        }
      }
    });

    leafer.add(mainGroup);
    console.log('Leafer-UI canvas created successfully');
  </script>
</body>
</html>
